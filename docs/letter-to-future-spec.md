# 未来への手紙（Letter to the Future）仕様書

## 概要

未来の自分に手紙を書いて、指定した日時に届くタイムカプセル機能。

## 基本コンセプト

- 未来の自分に手紙を書く
- 開封日時まで内容は**完全封印**（見えない）
- 届いた時に**サプライズ**で通知
- 「忘れた頃に届く」体験を重視

## 配置

| 場所 | 用途 |
|------|------|
| **設定画面** | 手紙を作成・管理（未送信/送信済み/開封済みリスト） |
| **今日タブ** | 届いた日のみ表示（ヘッダー直下、翌日に自動消去） |

※カレンダーには表示しない（サプライズ重視）

## 手紙の構成要素

| 項目 | 必須 | 備考 |
|------|------|------|
| 本文 | ✅ | テキスト |
| 写真 | ❌ | 複数枚添付可能 |
| 開封日時 | ✅ | 固定 or ランダム |

## 開封日時の設定

### UI: パターンA（セグメント切り替え）

```
┌─────────────────────────────────┐
│ 開封日時の設定                    │
├─────────────────────────────────┤
│ [固定] [ランダム]                 │  ← セグメント
├─────────────────────────────────┤
│ 固定を選択時:                     │
│   日時: 2025/01/01 12:00          │
├─────────────────────────────────┤
│ ランダムを選択時:                  │
│                                 │
│ 期間: [指定しない ▼]              │
│       ↓ 指定するなら              │
│       開始: 2025/01/01            │
│       終了: 2025/03/31            │
│                                 │
│ 時間帯: [指定しない ▼]             │
│        ↓ 指定するなら             │
│        開始: 09:00               │
│        終了: 21:00               │
└─────────────────────────────────┘
```

### ランダムの種類

| モード | 期間 | 時間 | 説明 |
|--------|------|------|------|
| 完全ランダム | 未指定 | 未指定 | いつ届くか全く分からない |
| 期間指定ランダム | 1/1〜3/31 | 未指定 | 期間内のどこか（深夜も可能性あり） |
| 時間指定ランダム | 未指定 | 9:00〜21:00 | 日付不明、時間帯は制限 |
| 期間＋時間指定 | 1/1〜3/31 | 9:00〜21:00 | 期間内の指定時間帯のどこか |

## 通知

### プッシュ通知

**テンプレート**: 📨 {送信日}のあなたから手紙が届きました

**例**: 📨 2024年12月8日のあなたから手紙が届きました

### アプリ内通知

開封可能な手紙がある場合、今日タブのヘッダー直下に特別カードを表示:

```
┌─────────────────────────────────┐
│ 📬 過去のあなたから手紙が届いています │
│                                 │
│    [開封する]                    │
└─────────────────────────────────┘
```

- 特別な背景色で目立たせる
- 届いた日のみ表示（翌日消える）

## 開封アニメーション

### インタラクション

封筒を指でなぞって破って開封する体験:

1. **封筒表示**: 破線（開封ライン）付きの封筒画像
2. **スワイプ開始**: 指で破線をなぞり始める
3. **破れる進捗**: なぞった距離に応じて封筒が破れていく
4. **バイブ強度UP**: 進捗に応じてハプティクスが強くなる
5. **破り切る**: 成功バイブ + 手紙がふわっと登場

### 技術要素

| 要素 | 使用技術 |
|------|----------|
| 指でなぞる | `DragGesture` |
| 破れる進捗 | ジェスチャーの移動距離を追跡 |
| 封筒が破れるビジュアル | `mask` + アニメーション |
| バイブ強くなる | `UIImpactFeedbackGenerator` で強度変更 |
| 破り切った時 | `UINotificationFeedbackGenerator.success()` |
| 手紙が出てくる | `transition` + `animation` |

## 手紙の状態

| 状態 | 説明 |
|------|------|
| 下書き | 作成中、まだ封印していない |
| 送信済み（封印中） | 封印完了、開封待ち |
| 開封可能 | 開封日時を過ぎた、未開封 |
| 開封済み | 読んだ |

## UI方針

- アプリ全体は純正風シンプルUI
- 「未来への手紙」は**特別な体験**なので、遊び心あるUIでOK
- メリハリをつけて差別化

## 今後の検討事項

- ~~開封済み手紙の保存・アーカイブ~~ → 基本ずっと保存
- ~~手紙を削除する機能~~ → ユーザーが消したいなら消せる

## 追加仕様（2024/12/8 決定）

| 項目 | 内容 |
|------|------|
| 完全ランダムの最大期間 | **3年** |
| 手紙の枚数制限 | **無制限**（同時に何通でも封印可能） |
| 開封済み手紙の保存 | **ずっと保存**、ユーザーが削除可能 |

---

## TODO（将来の改善）

### 1. ディープリンク対応
- 通知タップで直接開封画面へ遷移
- AppDelegateでの通知ハンドリング実装

### 2. 開封アニメーションの強化
- [ ] 効果音追加（封筒が破れる音）
- [ ] 画面を揺らす演出（破り進行中）
- [ ] より「破れてる感」のあるビジュアル（破線が裂けていく）
- [ ] パーティクルエフェクト（紙片が散る）

### 3. 封筒UIの改善
- [ ] よりリアルな封筒デザイン
- [ ] 封蝋（シーリングワックス）風の封印マーク
- [ ] 手書き風フォント対応

### 4. 開封後の手紙表示UI改善
- [ ] 便箋風のデザイン
- [ ] 添付写真のギャラリー表示
- [ ] 手紙をシェアする機能

### 5. 設定画面「未来への手紙」UI改善 ✅ 仕様確定

**画面構成（上から順に）:**
1. ✏️ **新しい手紙を書く** - 目立つCTAボタン
2. 📬 **開封待ち** - 配達日を過ぎた未開封の手紙のみ表示（開封ボタン付き）
3. 📖 **開封済み** - 過去の手紙一覧（振り返り用）

**非表示:**
- 送信済み（未到着）の手紙は**完全非表示**（ネタバレ防止）
- 下書き機能は実装なし

**送信確認ダイアログ:**
> ⚠️ 手紙を送信しますか？
> 送信後は届くまで編集・削除ができません。
> [キャンセル] [送信する]