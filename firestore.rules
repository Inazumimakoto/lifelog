rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    // ユーザーコレクション: 自分のデータのみ読み書き可能
    match /users/{userId} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }
    
    // ペアリングコレクション: 自分が関係するデータのみ
    match /pairings/{pairingId} {
      allow read, write: if request.auth != null;
    }
    
    // 招待リンク: 認証済みユーザーのみ
    match /inviteLinks/{linkId} {
      allow read, write: if request.auth != null;
    }
    
    // 暗号化手紙: 認証済みユーザーのみ
    match /encryptedLetters/{letterId} {
      allow read, write: if request.auth != null;
    }
    
    // 通報: 認証済みユーザーのみ作成可能
    match /reports/{reportId} {
      allow create: if request.auth != null;
      allow read: if false; // 運営のみ
    }
  }
}